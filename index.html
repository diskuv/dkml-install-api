<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Getting Started with the DKML Install API &mdash; DKML Install API  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Console Packager" href="doc/packages/Console.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #3347A9" >
            <a href="#" class="icon icon-home"> DKML Install API
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started with the DKML Install API</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc/packages/Console.html">Console Packager</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc/components/index.html">Component Authors</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc/components/index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc/Design.html">Design</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #3347A9" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">DKML Install API</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home"></a> &raquo;</li>
      <li>Getting Started with the DKML Install API</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="getting-started-with-the-dkml-install-api">
<h1>Getting Started with the DKML Install API<a class="headerlink" href="#getting-started-with-the-dkml-install-api" title="Permalink to this headline"></a></h1>
<p>The DKML Install API lets you take the tools you know (OCaml and Opam) and
well-known¹ installer generators, to generate a installer for your OCaml
project.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>¹ <em>Well-known</em> is an aspiration. Currently only a simple CLI installer
generator is available, but other well-known installer generators like
0install or cpack could be added in the future.</p>
</div>
<p>Specifically the DKML Install API lets you take a) pre-designed packages from
Opam and b) installation instructions written in OCaml source code, and
assembles binary artifacts that act as the primary materials to installer
generators.</p>
<p><strong>Why use it?</strong></p>
<p>Often you start with the most basic installation logic: copy a directory of
prebuilt binaries and other files into the installation directory.
Later you realize you need to customize a configuration file, populate a
database or compile assets at installation time. Now you have several options:</p>
<ol class="arabic simple">
<li><p>You generate the configuration/database/assets when your
program is first run. You made a trade-off: instead of notifying your user
of problems early, they don’t find out until the program is run for the first
time. Sometimes that is a perfectly acceptable trade-off.</p></li>
<li><p>You follow your target platform’s recommendation; for example the
<a class="reference external" href="https://docs.fedoraproject.org/en-US/packaging-guidelines/#_scripting_inside_of_specfiles">Fedora Linux Packaging Guidelines</a>
suggest using the Lua interpreter embedded in the Fedora/RedHat <code class="docutils literal notranslate"><span class="pre">rpm</span></code> package
manager for any scripting needs. For other target platforms like Windows
and non-RedHat based package managers, you modify your installer to first
install the Lua interpreter. You made a trade-off:
you need to write some of your core logic in a language like Lua which is
likely unfamiliar to you or your OCaml application developers,
and you may need to rewrite or duplicate some of your existing OCaml logic
in Lua or whatever the target platform recommends.</p></li>
<li><p>You follow the widespread practice of using portable scripts. On Unix systems
you write POSIX shell scripts that run with the Bourne shell available on
almost all Unix machines. On Windows system you write PowerShell scripts
which have been the basis of Windows package managers like
<a class="reference external" href="https://docs.chocolatey.org/en-us/create/create-packages">Chocolatey</a>.</p></li>
</ol>
<p>By now you should see that you can rapidly accumulate technical debt when your
installation logic gets complex quick. The original author of the DKML Install
API followed option #3 when developing a
Windows-friendly installer for OCaml. The installer worked well but other
developers would have difficulty contributing to
<a class="reference external" href="https://gitlab.com/diskuv/diskuv-ocaml/-/tree/v0.3.3/installtime">its Unix and Windows portable scripts</a>.</p>
<p>As OCaml application developers, you already know how to embed complex
logic in OCaml. With the DKML Install API you:</p>
<ul class="simple">
<li><p>inform your users of setup problems early during installation rather than
at runtime. That avoids the tradeoff for option #1</p></li>
<li><p>gain the ability to write your installation logic in a language you are
already familiar with. That avoids the tradeoff for option #2 and #3</p></li>
<li><p>gain the ability to test units of your installation logic with
your normal OCaml test infrastructure (Alcotest, ppx_expect, etc.)</p></li>
</ul>
<p>but you will need to accept a learning curve for:</p>
<ul class="simple">
<li><p>how to use this DKML Install API</p></li>
<li><p>how to write Opam packages that install artifacts to non-standard locations</p></li>
<li><p>how to use OCaml libraries like <a class="reference external" href="https://erratique.ch/software/bos">Daniel Bünzli’s Bos library</a>
for cross-platform portable file and directory handling and
<a class="reference external" href="https://github.com/CraigFe/progress#readme">Craig Ferguson’s Progress library</a>
for showing progress bars</p></li>
</ul>
<div class="toctree-wrapper compound">
<p class="caption" role="heading"><span class="caption-text">Table of Contents</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started with the DKML Install API</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc/packages/Console.html">Console Packager</a><ul>
<li class="toctree-l2"><a class="reference internal" href="doc/packages/Console.html#generating-the-installer-starts-with-an-opam-switch">Generating the installer starts with an Opam switch</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc/packages/Console.html#what-are-these-components">What are these components?</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc/packages/Console.html#use-the-generated-create-installers-exe">Use the generated <code class="docutils literal notranslate"><span class="pre">create_installers.exe</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="doc/packages/Console.html#bring-your-own-archiver-archives">Bring-your-own-archiver archives</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc/packages/Console.html#setup-exe-installers">setup.exe installers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="doc/components/index.html">Component Authors</a><ul>
<li class="toctree-l2"><a class="reference internal" href="doc/components/index.html">Component Authors</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc/components/WritingComponents.html">Writing Components</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc/components/StandardComponents.html">Standard Components</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="doc/components/index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="doc/Design.html">Design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="doc/Design.html#goals">Goals</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc/Design.html#terms">Terms</a></li>
<li class="toctree-l2"><a class="reference internal" href="doc/Design.html#packaging-flow">Packaging Flow</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="indices-and-tables">
<h1>Indices and tables<a class="headerlink" href="#indices-and-tables" title="Permalink to this headline"></a></h1>
<ul class="simple">
<li><p><a class="reference internal" href="genindex.html"><span class="std std-ref">Index</span></a></p></li>
<li><p><a class="reference internal" href="py-modindex.html"><span class="std std-ref">Module Index</span></a></p></li>
<li><p><a class="reference internal" href="search.html"><span class="std std-ref">Search Page</span></a></p></li>
</ul>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="doc/packages/Console.html" class="btn btn-neutral float-right" title="Console Packager" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Diskuv, Inc..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>