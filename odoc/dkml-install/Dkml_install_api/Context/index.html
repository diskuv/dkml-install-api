<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Context (dkml-install.Dkml_install_api.Context)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">dkml-install</a> &#x00BB; <a href="../index.html">Dkml_install_api</a> &#x00BB; Context</nav><header class="odoc-preamble"><h1>Module <code><span>Dkml_install_api.Context</span></code></h1><p><code>Context</code> is a module providing a record type for the context.</p></header><div class="odoc-content"><div class="odoc-include"><div class="odoc-spec"><div class="spec module" id="module-Abi_v2" class="anchored"><a href="#module-Abi_v2" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Abi_v2/index.html">Abi_v2</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>ABI V2 is the version 2 of the supported list of ABIs</p></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = </span><span>{</span></code><table><tr id="type-t.path_eval" class="anchored"><td class="def record field"><a href="#type-t.path_eval" class="anchor"></a><code><span>path_eval : <span>string <span class="arrow">&#45;&gt;</span></span> <span class="xref-unresolved">Fpath</span>.t;</span></code></td></tr><tr id="type-t.eval" class="anchored"><td class="def record field"><a href="#type-t.eval" class="anchor"></a><code><span>eval : <span>string <span class="arrow">&#45;&gt;</span></span> string;</span></code></td></tr><tr id="type-t.host_abi_v2" class="anchored"><td class="def record field"><a href="#type-t.host_abi_v2" class="anchor"></a><code><span>host_abi_v2 : <a href="Abi_v2/index.html#type-t">Abi_v2.t</a>;</span></code></td></tr><tr id="type-t.log_config" class="anchored"><td class="def record field"><a href="#type-t.log_config" class="anchor"></a><code><span>log_config : <a href="../Log_config/index.html#type-t">Log_config.t</a>;</span></code></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p><code>t</code> is the record type for the context.</p><p>Context Fields</p><p>The following fields are available from the context today:</p><ul><li><p><code>ctx.path_eval &quot;/some/path/expression&quot;</code></p><p>Evaluates the given path expression, resolving any templates embedded in the expression. You may use slashes (&quot;/&quot;) even on Windows; the evaluation of the expression will convert the path into native Windows (ex. C:\Program Files) or Unix format (ex. /usr/local/share).</p><p>An example expression is <code>&quot;%{ocamlrun:share}/generic/bin/ocamlrun&quot;</code> which would be the location of ocamlrun.exe within the staging files directory.</p><p>Templates:</p><ul><li><code>&quot;%{prefix}&quot;</code> is the absolute path of the final installation directory. If you are following <a href="https://www.gnu.org/prep/standards/html_node/Directory-Variables.html">GNU directory standards</a>, you should populate <code>&quot;%{prefix}&quot;</code> with subdirectories &quot;bin/&quot;, &quot;share/&quot;, etc.</li><li><code>&quot;%{name}&quot;</code> is the name of the component currently being installed</li><li><code>&quot;%{tmp}&quot;</code> is the absolute path to a temporary directory unique to the component that is currently being installed. No other component will use the same temporary directory.</li><li><code>&quot;%{_:share}&quot;</code> and <code>&quot;%{COMPONENT_NAME:share}&quot;</code> are the absolute path within the staging directory of the currently-being-installed and the named component, respectively. <em><b>Only COMPONENT_NAMEs that are transitive dependencies of the currently-being-installed component will be resolved.</b></em> Usually the staging files include a bytecode executable to run a component's installation logic.</li></ul><p>Variations:</p><ul><li><b>Staging Files</b>: When dkml-install-runner.exe is run with the <code>&quot;--staging-files DIR&quot;</code> option then the staging directory is simply <code>&quot;&lt;DIR&gt;/&lt;COMPONENT_NAME&gt;&quot;</code>. During an end-user installation the <code>&quot;--staging-files DIR&quot;</code> option is automatically used. When dkml-install-runner.exe is run with the <code>&quot;--opam-context&quot;</code> option then the staging directory is <code>&quot;$OPAM_SWITCH_PREFIX/share/dkml-component-&lt;COMPONENT_NAME&gt;/staging-files&quot;</code>. You can use the <code>&quot;--opam-context&quot;</code> option to test your components in an Opam environment.</li></ul></li><li><p><code>ctx.eval &quot;/some/expression&quot;</code></p><p>Evaluates the given expression, resolving any templates embedded in the expression.</p><p>An example expression is <code>&quot;%{components:all}&quot;</code>.</p><p>All templates that are available with <code>path_eval</code> are available with <code>eval</code>. However unlike <code>path_eval</code> the <code>eval</code> function will do no path conversions on Windows. In addition <code>eval</code> has templates that are not available in <code>path_eval</code>.</p><p>Templates available to <code>eval</code> but not in <code>path_eval</code>:</p><ul><li><code>&quot;%{components:all}&quot;</code> is the space separated names of the components that are or will be installed</li></ul></li><li><p><code>ctx.host_abi_v2</code></p><p>The ABI for the host machine from the list of V2 ABIs. You cannot rely on inspecting the OCaml bytecode interpreter since the interpreter is often compiled to 32-bit for maximum portability. When more host ABIs are supported they will go into a future <code>ctx.host_abi_v3</code> or later; for type-safety <code>ctx.host_abi_v2</code> will give a <code>Result.Error</code> for those new host ABIs.</p><p>Values for the V2 ABI include:</p><p>* Android_arm64v8a * Android_arm32v7a * Android_x86 * Android_x86_64 * Darwin_arm64 * Darwin_x86_64 * Linux_arm64 * Linux_arm32v6 * Linux_arm32v7 * Linux_x86_64 * Linux_x86 * Windows_x86_64 * Windows_x86</p></li><li><p><code>ctx.log_config</code></p><p>The logging configuration. See the Logging section of <a href="../index.html"><code>Dkml_install_api</code></a> for how to use it.</p></li></ul></div></div></div></div></body></html>