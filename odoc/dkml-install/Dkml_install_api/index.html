<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Dkml_install_api (dkml-install.Dkml_install_api)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../index.html">dkml-install</a> &#x00BB; Dkml_install_api</nav><header class="odoc-preamble"><h1>Module <code><span>Dkml_install_api</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#component-configuration">Component Configuration</a></li></ul></nav><div class="odoc-content"><h3 id="component-configuration"><a href="#component-configuration" class="anchor"></a>Component Configuration</h3><p>You are responsible for creating a module of type <a href="module-type-Component_config/index.html"><code>Component_config</code></a> to describe your component. A do-nothing implementation for most of the module is available as <a href="Default_component_config/index.html"><code>Default_component_config</code></a>.</p><p><code>Dkml_install_api</code> will use the <a href="module-type-Component_config/index.html"><code>Component_config</code></a> to create four (4) command line applications.</p><p>Each of the command line applications are &quot;subcommands&quot; in the language of the OCaml <code>Cmdliner</code> package. You will not need to understand Cmdliner to define your own component, although you may visit the <a href="https://erratique.ch/software/cmdliner">Cmdliner documentation</a> if you want more information.</p><p>The four (4) command line applications have limited access to the OCaml runtime. The expectation is that all installation logic is embedded in bytecode executables which have the complete set of package dependencies you need to run your logic. Through <a href="module-type-Component_config/index.html"><code>Component_config</code></a> <code>Dkml_install_api</code> will have given you a <code>~ctx_t</code> Cmdliner term that, when evaluated, leads to the context record <a href="Context/index.html#type-t"><code>Context.t</code></a>. The context record has the information needed to run your bytecode executables.</p><p>On Windows it is <a href="https://docs.microsoft.com/en-us/windows/security/identity-protection/user-account-control/how-user-account-control-works">recommended security practice</a> to separate functionality that requires administrative privileges from functionality that does not require non-administrative privileges. <code>Dkml_install_api</code> follows the same recommendations:</p><ul><li>There will be a <em>single</em> executable <code>&quot;dkml-install-admin-runner.exe&quot;</code> that is responsible for the following functionality for <em>all</em> components:</li></ul><ol><li>Administrator installation defined by <a href="module-type-Component_config/index.html#val-install_admin_subcommand"><code>Component_config.install_admin_subcommand</code></a></li><li>Administrator uninstallation defined by <a href="module-type-Component_config/index.html#val-uninstall_admin_subcommand"><code>Component_config.uninstall_admin_subcommand</code></a></li></ol><ul><li>There will be a <em>single</em> executable <code>&quot;dkml-install-user-runner.exe&quot;</code> that is responsible for the following functionality for <em>all</em> components:</li></ul><ol><li>User installation defined by <a href="module-type-Component_config/index.html#val-install_user_subcommand"><code>Component_config.install_user_subcommand</code></a></li><li>User uninstallation defined by <a href="module-type-Component_config/index.html#val-uninstall_user_subcommand"><code>Component_config.uninstall_user_subcommand</code></a></li></ol><div class="odoc-spec"><div class="spec module" id="module-Context" class="anchored"><a href="#module-Context" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Context/index.html">Context</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p><code>Context</code> is a module providing a record type for the context.</p></div></div><div class="odoc-include"><div class="odoc-spec"><div class="spec module-type" id="module-type-Component_config_defaultable" class="anchored"><a href="#module-type-Component_config_defaultable" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Component_config_defaultable/index.html">Component_config_defaultable</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Component configuration values that can be supplied with defaults.</p></div></div><div class="odoc-spec"><div class="spec module-type" id="module-type-Component_config" class="anchored"><a href="#module-type-Component_config" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-Component_config/index.html">Component_config</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Each component must define a configuration module</p></div></div><p>You <em>should</em> <code>include Default_component_config</code> in any of your components so that your component can be future-proof against changes in the <a href="module-type-Component_config/index.html"><code>Component_config</code></a> signature.</p><div class="odoc-spec"><div class="spec module" id="module-Default_component_config" class="anchored"><a href="#module-Default_component_config" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Default_component_config/index.html">Default_component_config</a></span><span> : <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div><div class="spec-doc"><p>Default values for a subset of the module type <a href="module-type-Component_config/index.html"><code>Component_config</code></a>.</p></div></div><div class="odoc-spec"><div class="spec module" id="module-Log_config" class="anchored"><a href="#module-Log_config" class="anchor"></a><code><span><span class="keyword">module</span> <a href="Log_config/index.html">Log_config</a></span><span> : <span class="keyword">module</span> <span class="keyword">type</span> <span class="keyword">of</span> <a href="Log_config/index.html">Log_config</a></span></code></div></div><div class="odoc-spec"><div class="spec exception" id="exception-Installation_error" class="anchored"><a href="#exception-Installation_error" class="anchor"></a><code><span><span class="keyword">exception</span> </span><span><span class="exception">Installation_error</span> <span class="keyword">of</span> string</span></code></div><div class="spec-doc"><p>Raise <code>Installation_error message</code> when your component has a terminal failure</p></div></div><div class="odoc-spec"><div class="spec value" id="val-log_spawn_and_raise" class="anchored"><a href="#val-log_spawn_and_raise" class="anchor"></a><code><span><span class="keyword">val</span> log_spawn_and_raise : <span><span class="xref-unresolved">Bos</span>.Cmd.t <span class="arrow">&#45;&gt;</span></span> unit</span></code></div><div class="spec-doc"><p><code>log_spawn_and_raise cmd</code> logs the command <code>cmd</code> and runs it synchronously, raising <a href="#exception-Installation_error"><code>Installation_error</code></a> if the command exits with a non-zero error code.</p><p>The environment variable <code>&quot;OCAMLRUNPARAM&quot;</code> will be set to <code>&quot;b&quot;</code> so that any OCaml bytecode launched by <code>log_spawn_and_raise</code> will have backtraces. Any exiting environment variable <code>&quot;OCAMLRUNPARAM&quot;</code> will be kept, however.</p></div></div></div></div></body></html>