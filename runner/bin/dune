(executable
 (public_name dkml-install-user-runner)
 (name user_main)
 (package dkml-install-runner)
 (modules user_main)
 (libraries
  dkml-install.register
  dkml-install-runner.sites
  runner
  dune-site
  dune-site.plugins
  cmdliner))

(rule
 (targets admin-link-flags.sexp)
 (deps
  (:discover config/discover.exe))
 (action
  (run %{discover})))

(executable
 (public_name dkml-install-admin-runner)
 (name admin_main)
 (package dkml-install-runner)
 (modules admin_main)
 ; To view Application Manifest on Windows, or to sign it, make sure
 ; any ".NET Framework <VERSION> SDK" component is installed with the
 ; Visual Studio Installer. That will give you Mage.exe and MageUI.exe.
 ; Confer: https://docs.microsoft.com/en-us/dotnet/framework/tools/mageui-exe-manifest-generation-and-editing-tool-graphical-client
 ; 
 ; To extract the manifest file:
 ;  & "C:\Program Files (x86)\Windows Kits\10\bin\10.0.19041.0\x64\mt.exe" '-inputresource:Z:\source\dkml-install-api\_build\install\default\bin\dkml-install-admin-runner.exe;#1' -out:admin2.manifest
 (ocamlopt_flags
  ; Uncomment the following to see how link.exe is invoked through flexlink.exe:
  ; -cclib
  ; -v
  (:include admin-link-flags.sexp))
 (libraries
  dkml-install.register
  dkml-install-runner.sites
  runner
  dune-site
  dune-site.plugins
  cmdliner))
